# ===========================================
# n8n Docker Stack Environment Configuration
# ===========================================
# Copy this file to .env and fill in your values
# NEVER commit .env to version control
#
# Generated: 2025-12-27
# Documentation: docs/CONFIGURATION.md
# ===========================================

# ===========================================
# PostgreSQL Configuration
# ===========================================
# Database credentials for n8n persistence
# Generate password: openssl rand -base64 32
POSTGRES_USER=n8n
POSTGRES_PASSWORD=<generate-secure-password-here>
POSTGRES_DB=n8n
POSTGRES_HOST=postgres
POSTGRES_PORT=5432

# ===========================================
# Redis Configuration
# ===========================================
# Message broker for queue mode
# Using non-standard port to avoid conflicts with other Redis instances
REDIS_HOST=redis
REDIS_PORT=6386

# ===========================================
# n8n Core Configuration
# ===========================================
# Generate key: openssl rand -base64 32
# WARNING: Changing this after setup makes existing credentials unrecoverable
N8N_ENCRYPTION_KEY=<generate-encryption-key-here>

# Host configuration (localhost for development, ngrok domain for external access)
N8N_HOST=localhost
N8N_PORT=5678
N8N_PROTOCOL=http
WEBHOOK_URL=http://localhost:5678/

# Timezone for scheduled workflows
GENERIC_TIMEZONE=America/New_York
N8N_USER_FOLDER=/home/node/.n8n

# ===========================================
# n8n Queue Mode (Required for Workers)
# ===========================================
# Enable distributed execution across workers
EXECUTIONS_MODE=queue
QUEUE_BULL_REDIS_HOST=redis
QUEUE_BULL_REDIS_PORT=6386
QUEUE_HEALTH_CHECK_ACTIVE=true
QUEUE_BULL_REDIS_TIMEOUT_THRESHOLD=60000

# ===========================================
# n8n Worker Scaling Configuration
# ===========================================
# Concurrent executions per worker (5 workers x 10 = 50 total capacity)
EXECUTIONS_CONCURRENCY=10
# Route manual executions to workers (keeps UI responsive)
OFFLOAD_MANUAL_EXECUTIONS_TO_WORKERS=true

# ===========================================
# n8n Data Management
# ===========================================
# Auto-prune old execution data to prevent database bloat
EXECUTIONS_DATA_PRUNE=true
EXECUTIONS_DATA_MAX_AGE=168
EXECUTIONS_DATA_PRUNE_MAX_COUNT=50000
# Enable Prometheus-compatible metrics at /metrics
N8N_METRICS=true

# ===========================================
# n8n Security
# ===========================================
# Set to 'false' for localhost HTTP development
# Set to 'true' when using HTTPS (ngrok, reverse proxy)
N8N_SECURE_COOKIE=false

# ===========================================
# Database Connection
# ===========================================
# PostgreSQL connection for n8n (references variables above)
DB_TYPE=postgresdb
DB_POSTGRESDB_HOST=postgres
DB_POSTGRESDB_PORT=5432
DB_POSTGRESDB_DATABASE=n8n
DB_POSTGRESDB_USER=n8n
DB_POSTGRESDB_PASSWORD=${POSTGRES_PASSWORD}

# ===========================================
# ngrok Tunnel Configuration (Phase 02)
# ===========================================
# Get authtoken from: https://dashboard.ngrok.com/get-started/your-authtoken
# Custom domain configured in ngrok dashboard
NGROK_AUTHTOKEN=<your-ngrok-authtoken-here>
NGROK_DOMAIN=<your-custom-domain>.ngrok.dev
NGROK_INSPECTOR_PORT=4040

# ===========================================
# External Access Configuration (Phase 02)
# ===========================================
# Uncomment and update these when enabling ngrok tunnel:
#
# N8N_HOST=your-custom-domain.ngrok.dev
# N8N_PROTOCOL=https
# WEBHOOK_URL=https://your-custom-domain.ngrok.dev/
# N8N_SECURE_COOKIE=true

# ===========================================
# Backup Encryption Configuration (Phase 03)
# ===========================================
# GPG passphrase for symmetric backup encryption
# Generate: openssl rand -base64 32
# WARNING: Store securely - losing this makes encrypted backups unrecoverable
BACKUP_GPG_PASSPHRASE=<generate-secure-passphrase-here>

# ===========================================
# Off-site Backup Configuration (Phase 03)
# ===========================================
# rclone remote name (configured via 'rclone config')
# Install rclone: curl https://rclone.org/install.sh | sudo bash
RCLONE_REMOTE=n8n-backup
# Remote bucket/container name
RCLONE_BUCKET=n8n-backups
# Sync encrypted files only (recommended: true)
RCLONE_SYNC_ENCRYPTED_ONLY=true
