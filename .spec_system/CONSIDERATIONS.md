# Considerations

> Institutional memory for AI assistants. Updated between phases via /carryforward.
> **Line budget**: 600 max | **Last updated**: Phase 00 (2025-12-26)

---

## Active Concerns

Items requiring attention in upcoming phases. Review before each session.

### Technical Debt
<!-- Max 5 items -->

*None identified in Phase 00*

### External Dependencies
<!-- Max 5 items -->

- [P00] **n8n:latest image tag**: Using `n8nio/n8n:latest` pulls unpinned version. Consider pinning to specific version (currently 2.1.4) for production stability.

- [P00] **Redis vm.overcommit_memory warning**: Redis logs warning about vm.overcommit_memory setting. Requires host-level sysctl change for optimal performance.

### Performance / Security
<!-- Max 5 items -->

- [P00] **WSL2 8GB RAM constraint**: System configured with 8GB RAM limit. Monitor memory usage under load - may need adjustment for heavy workflow execution.

- [P00] **Secure cookie disabled**: `N8N_SECURE_COOKIE=false` for localhost development. Must enable when exposing to network.

- [P00] **Single worker instance**: Running 1 worker with concurrency 10. Scale to 5+ workers for production throughput.

### Architecture
<!-- Max 5 items -->

- [P00] **Manual execution offload**: `OFFLOAD_MANUAL_EXECUTIONS_TO_WORKERS` not enabled. Consider enabling to reduce main instance load.

- [P00] **No backup automation**: PostgreSQL and Redis data unprotected. Implement backup scripts in Phase 01.

---

## Lessons Learned

Proven patterns and anti-patterns. Reference during implementation.

### What Worked
<!-- Max 15 items -->

- [P00] **Explicit WSL2 resource limits**: Set memory/CPU/swap in .wslconfig for predictable container behavior. Without limits, WSL2 uses host maximum causing resource contention.

- [P00] **Systemd for Docker auto-start**: Use systemd (wsl.conf) over bashrc workarounds. Provides proper service management and starts Docker before shell sessions.

- [P00] **Named Docker volumes**: Use named volumes (`postgres_data`, `redis_data`) over bind mounts for better portability and Docker-native management.

- [P00] **Service names as hostnames**: Use Docker service names (`postgres`, `redis`) for inter-container communication. More reliable than localhost or IP addresses.

- [P00] **Health checks with depends_on**: Implement health checks on all services. Use `depends_on` with `condition: service_healthy` for proper startup sequencing.

- [P00] **Environment variable externalization**: Store all secrets in `.env` with `${VAR}` references in docker-compose.yml. Never hardcode secrets.

- [P00] **Sequential deployment by dependency**: Deploy services in dependency order (postgres -> redis -> n8n -> worker) to ensure reliable connectivity.

- [P00] **Non-standard ports for conflicts**: Use port 6386 for Redis to avoid conflicts with host-installed instances. Document port assignments.

- [P00] **YAML document start marker**: Always include `---` at start of YAML files. Required for proper yamllint validation.

- [P00] **Verification over reinstallation**: Check existing installations against spec requirements before reinstalling. Saves time and preserves working configurations.

### What to Avoid
<!-- Max 10 items -->

- [P00] **Default WSL2 resources**: Never rely on WSL2 defaults (uses host max). Always set explicit limits in .wslconfig for reproducible environments.

- [P00] **docker-compose hyphen**: Use `docker compose` (space) not `docker-compose` (hyphen) with Docker Engine 20+. The hyphen version is deprecated.

- [P00] **Standard Redis port in multi-project**: Avoid port 6379 when multiple Redis instances may exist. Use project-specific ports.

- [P00] **Assuming init script execution**: PostgreSQL init scripts only run on first container start with empty data directory. Plan accordingly for existing volumes.

### Tool/Library Notes
<!-- Max 5 items -->

- [P00] **Docker Compose v5.0.0+**: No `version:` field required in compose files. Modern syntax preferred.

- [P00] **n8n queue mode Redis config**: Use `QUEUE_BULL_REDIS_*` variables, not standard `REDIS_*` variables. n8n has separate configuration namespaces.

- [P00] **WSL requires restart for .wslconfig**: Changes to .wslconfig only apply after `wsl.exe --shutdown` and restart. Plan for session interruption.

---

## Resolved

Recently closed items (buffer - rotates out after 2 phases).

| Phase | Item | Resolution |
|-------|------|------------|
| P00 | WSL2 environment setup | Configured 8GB/4CPU/2GB swap, localhost forwarding enabled |
| P00 | Docker installation | Verified Docker 29.1.3, Compose 5.0.0, NVIDIA runtime pre-configured |
| P00 | Project structure | Created docker-compose.yml, .env, directory structure, init scripts |
| P00 | Service deployment | All 4 containers healthy (postgres, redis, n8n, worker) |

---

*Auto-generated by /carryforward. Manual edits allowed but may be overwritten.*
